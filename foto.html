<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Scatta e Salva Foto</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }
        video, img {
            width: 100%;
            max-width: 300px;
            margin-top: 10px;
        }
        .image-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h2>Scatta una foto</h2>
<video id="video" autoplay></video>
<br>
<button id="captureBtn">ðŸ“¸ Scatta Foto</button>

<h2>Le tue foto salvate</h2>
<div class="image-container" id="imageContainer"></div>

<script>
    let video = document.getElementById('video');
    let imageContainer = document.getElementById('imageContainer');

    // Attiva la fotocamera
    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
        video.srcObject = stream;
    });

    // IndexedDB setup
    const dbName = "PhotoDB";
    let db;

    const request = indexedDB.open(dbName, 1);
    request.onupgradeneeded = event => {
        db = event.target.result;
        db.createObjectStore("photos", { autoIncrement: true });
    };
    request.onsuccess = event => {
        db = event.target.result;
        loadImages();
    };

    // Scatta foto e salva
    document.getElementById('captureBtn').addEventListener('click', () => {
        let canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        let dataUrl = canvas.toDataURL('image/png');

        let tx = db.transaction("photos", "readwrite");
        let store = tx.objectStore("photos");
        store.add(dataUrl);

        tx.oncomplete = () => {
            loadImages(); // ricarica immagini
        };
    });

    // Carica immagini da IndexedDB
    function loadImages() {
        imageContainer.innerHTML = '';
        let tx = db.transaction("photos", "readonly");
        let store = tx.objectStore("photos");
        let request = store.getAll();

        request.onsuccess = () => {
            request.result.forEach(dataUrl => {
                let img = document.createElement('img');
                img.src = dataUrl;
                imageContainer.appendChild(img);
            });
        };
    }
</script>

</body>
</html>
